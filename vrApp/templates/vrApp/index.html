{% load staticfiles %}
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <script src="http://d3js.org/d3.v3.min.js" type="text/javascript"></script>
    <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdn.webrtc-experiment.com/MediaStreamRecorder.js"> </script>
    <title>Record</title>
</head>
<body>
<div id="warpDiv">
    <div id="selectDiv">
        <div id="funcDiv1"></div>
        <div id="funcDiv2"></div>
    </div>
    <div id="textDiv">
        <div id="audioSelect">
            <div id="recordingStatus">
                <span id="time">0:00</span>
            </div>
            <button onclick="record()" id="start-recording"></button>
            <button onclick="play()"    id="stop-recording"   ></button>
            <button onclick="upload()"  id="upload-recording" ></button>
        </div>
    </div>
</div>

<script src="{% static 'vrApp/recorder.js' %}" type="text/javascript"></script>
<script src="{% static 'vrApp/vrJs.js' %}" type="text/javascript"></script>
<script src="{% static 'vrApp/audioRec.js' %}" type="text/javascript"></script>
<script src="{% static 'vrApp/audioToText.js' %}" type="text/javascript"></script>
<script src="{% static 'vrApp/findText.js' %}" type="text/javascript"></script>
<script>
       function timecode(ms) {
        var hms = {
          h: Math.floor(ms/(60*60*1000)),
          m: Math.floor((ms/60000) % 60),
          s: Math.floor((ms/1000) % 60)
        };
        var tc = []; // Timecode array to be joined with '.'
        if (hms.h > 0) {
          tc.push(hms.h);
        }
        tc.push((hms.m < 10 && hms.h > 0 ? "0" + hms.m : hms.m));
        tc.push((hms.s < 10  ? "0" + hms.s : hms.s));
        return tc.join(':');
      }
      function record(){
      console.log("rrrrrr");
        Recorder.record({
          start: function(){
            alert("recording starts now. press stop when youre done. and then play or upload if you want.");
          },
          progress: function(milliseconds){
            document.getElementById("time").innerHTML = timecode(milliseconds);
          }
        });
        console.log("rrrrrr#####");
      }

      function play(){
        Recorder.stop();
        Recorder.play({
          progress: function(milliseconds){
            document.getElementById("time").innerHTML = timecode(milliseconds);
          }
        });
      }

      function stop(){
        Recorder.stop();
      }

      function upload(){
            Recorder.upload({
              url:        "127.0.0.1:8000/vrData",
              audioParam: "audioFileRes",
              params: {
                "audioFile": new Date().getTime(),
                "textFile": ""
              },
              success: function(responseText){
                var track = $.parseJSON(responseText)
                window.location = track.permalink_url;
              }
            });
      }
window.onload = function () {

    //Security.allowDomain("*");
    //Security.allowInsecureDomain("*");
    mainDiv()
    audioRec();
    audioToText();
    findText();

console.log("aaaaa");
console.log(Recorder._initialized);
document.getElementById("warpDiv").style.backgroundImage="url(/static/vrApp/img/11.jpeg)";
Recorder.initialize({
   swfSrc: "/static/vrApp/swf/recorder.swf"
  });
console.log(Recorder._initialized);
}
</script>
</body>
</html>